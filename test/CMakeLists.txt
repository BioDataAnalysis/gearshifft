
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../inc)

if(CUDA_FOUND)
  set(TEST_EXEC test_cufft)
  add_executable(${TEST_EXEC} test_cufft.cpp)
  set(LIBS ${CUDA_LIBRARIES} ${CUDA_CUFFT_LIBRARIES})
  target_compile_definitions(${TEST_EXEC} PUBLIC -DBOOST_TEST_DYN_LINK)
  target_link_libraries(${TEST_EXEC} ${Boost_LIBRARIES} ${LIBS})
  add_test(NAME ${TEST_EXEC} COMMAND ${TEST_EXEC})
endif()

if(CLFFT_FOUND)
  set(TEST_EXEC test_clfft)
  add_executable(${TEST_EXEC} test_clfft.cpp)
  set(LIBS ${CLFFT_LIBRARIES} ${OpenCL_LIBRARIES})
  target_link_libraries(${TEST_EXEC} ${Boost_LIBRARIES} ${LIBS})
  target_compile_definitions(${TEST_EXEC} PUBLIC -DBOOST_TEST_DYN_LINK)
  add_test(NAME ${TEST_EXEC} COMMAND ${TEST_EXEC})

  set(TEST_EXEC test_clfft_global_fixture)
  add_executable(${TEST_EXEC} test_clfft_global_fixture.cpp)
  set(LIBS ${CLFFT_LIBRARIES} ${OpenCL_LIBRARIES})
  target_link_libraries(${TEST_EXEC} ${Boost_LIBRARIES} ${LIBS})
  target_compile_definitions(${TEST_EXEC} PUBLIC -DBOOST_TEST_DYN_LINK)
  add_test(NAME ${TEST_EXEC} COMMAND ${TEST_EXEC})
endif()

if(FFTW_FOUND)
  set(TEST_EXEC test_fftw)
  add_executable(${TEST_EXEC} test_fftw.cpp)
  set(LIBS ${FFTW_LIBRARIES})
  target_link_libraries(${TEST_EXEC} ${LIBS} ${Boost_LIBRARIES})
  target_compile_definitions(${TEST_EXEC} PUBLIC -DBOOST_TEST_DYN_LINK -DGEARSHIFFT_FFTW_THREADS=${GEARSHIFFT_FFTW_THREADS})
  add_test(NAME ${TEST_EXEC} COMMAND ${TEST_EXEC})
endif()

if(rocfft_FOUND)
  #https://github.com/ROCmSoftwarePlatform/rocFFT/wiki/Example-cpp-code-calling-rocFFT-routine-with--gnu-compiler
  # find_package(hip)
  # if(hip_FOUND)
  #   message("hip found!!")
  # endif()
  set(TEST_EXEC test_rocfft)
  find_library(hip_hcc NAME hip_hcc PATHS /opt/rocm/lib /opt/rocm/)
  add_executable(${TEST_EXEC} test_rocfft.cpp)
  set(LIBS ${hip_hcc} roc::rocfft roc::rocfft-device )
  target_link_libraries(${TEST_EXEC} ${LIBS} ${Boost_LIBRARIES})
  target_compile_definitions(${TEST_EXEC} PRIVATE -DBOOST_TEST_DYN_LINK -D__HIP_PLATFORM_HCC__)
  target_include_directories(${TEST_EXEC} PRIVATE ${rocfft_INCLUDE_DIR})
  target_include_directories(${TEST_EXEC} PRIVATE /opt/rocm/include)
  add_test(NAME ${TEST_EXEC} COMMAND ${TEST_EXEC})
endif()
